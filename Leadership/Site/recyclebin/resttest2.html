
<!DOCTYPE html>
<html>
  


<!--
<%@ Page language="C#" %>
<%@ Register Tagprefix="SharePoint" Namespace="Microsoft.SharePoint.WebControls" Assembly="Microsoft.SharePoint, Version=15.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" %>
<%@ Import Namespace="Microsoft.SharePoint" %>
-->



<head>
    
<meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=3, user-scalable=yes, width=device-width">
    <title></title>

    

<!--CSS Links here-->
	
	<!-- Sharepoint Dependencies -->
	<!--<script src="/_layouts/1033/init.js"></script>
    

<script src="/_layouts/1033/core.js"></script>
    <script src="//ajax.aspnetcdn.com/ajax/4.0/1/MicrosoftAjax.js"></script>
    <script src="/_layouts/SP.Core.js"></script>
    <script src="/_layouts/SP.Runtime.js"></script>
    <script src="/_layouts/SP.js"></script>
    <script src="/_layouts/SP.UI.Dialog.js"></script>
    <script src="/_layouts/ScriptResx.ashx?culture=en%2Dus&name=SP%2ERes"></script>

    <!--JS Links here-->
    
	<script type="text/javascript" src="//thebank.info53.com///ajax.aspnetcdn.com/ajax/4.0/1/MicrosoftAjax.js"></script>
	<script src="/_layouts/1033/init.js"></script>
    <script src="/_layouts/1033/core.js"></script>
    <script src="/_layouts/15/SP.Core.js"></script>
    <script src="/_layouts/15/SP.Runtime.js"></script>
    <script src="/_layouts/15/SP.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.5.3/bluebird.min.js"></script>

  

<!-- required: SharePoint FormDigest -->
	<form runat="server">
	<SharePoint:FormDigest runat="server"></SharePoint:FormDigest>
	</form>

        
	<script>
        var STATIC_PATH = _spPageContextInfo.webServerRelativeUrl + "/SiteAssets/app";
        var scripts = [
            "modules/jquery-3.3.1.min.js",
  </script>

</head>


<body>
<div>#TaskListContainer<div>
<div TaskListContainer><div>

<script>

var Module = {} || Module;


Module.GetTasks = (function () {

    var pub = {},

        _userId,            //userID of current user

        _tasks = [],        //List of our tasks

        _options = {

            listName: "testlist",                  //Name of list we want

            container: "#TaskListContainer",    //id of html element we're rendering our list of tasks in

        };



    //Module Initializer

    pub.init = function () {

        var clientContext = new SP.ClientContext.get_current();

        _userId = clientContext.get_web().get_currentUser();

        clientContext.load(_userId);

        clientContext.executeQueryAsync(getUserInfo, _onQueryFailed);

       

    };





    //Once we have our userId, we make Asyncronous call to get our list defined by _options.listName

    function getUserInfo() {

        _userId = _userId.get_id();



        getSpecifiedList(_options.listName, _userId);

    }



    //Makes a REST Call to grab a specified List with items assigned to the userId. Items must not have a status of 'Completed'

    function getSpecifiedList(listName, userId) {

        var url = _spPageContextInfo.webAbsoluteUrl + "/_api/lists/getbytitle('" + listName + "')/items?$filter=(AssignedTo eq '" + userId + "') and (Status ne 'Completed')";

        $.ajax({

            url: url,

            type: "GET",

            headers: {

                "accept": "application/json;odata=verbose",

            },

            success: function (results) { createTaskView(results, listName); },

            error: function (error) { 

                console.log("Error in getting List: " + listName); 

                $(_options.container).html("Error retrieving your " + listName + ".");

            }

        });

    }



    //Upon Receiving Task List data, we set as our module's _task list .

    //We then iterate through each task and add to a table which we then insert into our container defined in _options.container

    function createTaskView(results, listName) {

        _tasks = results.d.results;



        var table = $("<table style='width: 100%;'>" +

                            "<tr>" +

                                "<th>Title</th>" +

                                "<th>Due Date</th>" +

                                "<th>Status</th>" +

                            "</tr>" +

                      "</table>");

        $.each(_tasks, function (index, task) {

            var tr = '<tr>' +

                       '<td>' + task.Title + '</td>' +

                       '<td>' + new Date(item.DueDate).toLocaleDateString() + '</td>' +

                       '<td>' + task.Status + '</td>' +

                    '</tr>';

            table.append(tr);

        });

        $(_options.container).html(table);

    }



    function _onQueryFailed(sender, args) {

        alert('Request failed. \nError: ' + args.get_message() + '\nStackTrace: ' + args.get_stackTrace());

    }



    return pub;

}());



$(document).ready(function () {

    //must wait for SP scripts as we require them in our code

    SP.SOD.executeFunc('sp.js', 'SP.ClientContext', function () {

        Module.GetTasks.init();

    });

});
</script>
</body>
</html>